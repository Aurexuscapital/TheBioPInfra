<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Aurexus Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>Aurexus Dashboard</h1>

  <div id="auth">
    <button id="loginBtn">Log in / Sign up</button>
    <button id="logoutBtn" style="display:none;">Log out</button>
    <div id="whoami" style="margin-top:10px;"></div>
  </div>

  <div id="app" style="display:none; margin-top:20px;">
    <p>✅ You are signed in. Protected content goes here.</p>
  </div>

  <!-- Amplify from CDN (no build needed) -->
  <script src="https://unpkg.com/aws-amplify@6.0.0/dist/aws-amplify.min.js"></script>
  <script>
    // === Replace these with your Cognito values ===
    const userPoolId = "us-east-1_E2EZxHIro";
    const userPoolClientId = "1lijjoi66t6k9ioqbd9lgg4vle";
    const domain = "us-east-1e2exhiro.auth.us-east-1.amazoncognito.com";
    const redirectUri = "https://aurexuscapital.com/dashboard.html";  // this file’s URL
    const logoutUri = "https://aurexuscapital.com/";

    // Configure Amplify Auth (Cognito Hosted UI)
    aws_amplify.Amplify.configure({
      Auth: {
        Cognito: {
          userPoolId,
          userPoolClientId,
          // identityPoolId is optional; omit if you don’t use it
        },
        // Hosted UI config
        loginWith: {
          oauth: {
            domain,
            scopes: ['openid','email','profile'],
            redirectSignIn: [redirectUri],
            redirectSignOut: [logoutUri],
            responseType: 'code'
          }
        }
      }
    });

    const Auth = aws_amplify.Auth;

    async function refreshUI() {
      try {
        const user = await Auth.currentAuthenticatedUser();
        document.getElementById('whoami').textContent = `Signed in as: ${user?.attributes?.email || user?.username}`;
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
        document.getElementById('app').style.display = 'block';
      } catch {
        document.getElementById('whoami').textContent = 'Not signed in.';
        document.getElementById('loginBtn').style.display = 'inline-block';
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('app').style.display = 'none';
      }
    }

    document.getElementById('loginBtn').onclick = () => Auth.federatedSignIn(); // opens Hosted UI
    document.getElementById('logoutBtn').onclick = () => Auth.signOut({ global: true }).then(() => location.href = logoutUri);

    // Handle OAuth code → tokens
    Auth.handleRedirectPromise().finally(refreshUI);
  </script>
</body>
</html>
