<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Aurexus Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>Aurexus Dashboard</h1>

  <div id="auth">
    <button id="loginBtn">Log in / Sign up</button>
    <button id="logoutBtn" style="display:none;">Log out</button>
    <div id="whoami" style="margin-top:10px;"></div>
  </div>

  <div id="app" style="display:none; margin-top:20px;">
    <p>âœ… You are signed in. Protected content goes here.</p>
  </div>

  <!-- Amplify v6 from CDN -->
  <script src="https://unpkg.com/aws-amplify@6/dist/aws-amplify.min.js"></script>
  <script>
    // === YOUR Cognito config (verified values) ===
    const userPoolId       = "us-east-1_E2EzXHlro";
    const userPoolClientId = "1iJjoi6t6tK9ioqbd9lgg4vle";
    const domain           = "us-east-1e2exhiro.auth.us-east-1.amazoncognito.com";
    const redirectUri      = "https://aurexuscapital.com/dashboard.html";
    const logoutUri        = "https://aurexuscapital.com/";

    const { Amplify, Auth } = aws_amplify;

    Amplify.configure({
      Auth: {
        Cognito: {
          userPoolId,
          userPoolClientId,
          // identityPoolId optional
        },
        loginWith: {
          oauth: {
            domain,
            scopes: ['openid','email','profile'],
            redirectSignIn: [redirectUri],
            redirectSignOut: [logoutUri],
            responseType: 'code'
          }
        }
      }
    });

    async function refreshUI() {
      try {
        // Ensure tokens/session are available after redirect
        await Auth.fetchAuthSession();

        const user = await Auth.currentAuthenticatedUser();
        document.getElementById('whoami').textContent =
          `Signed in as: ${user?.attributes?.email || user?.username}`;
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
        document.getElementById('app').style.display = 'block';
      } catch (e) {
        document.getElementById('whoami').textContent = 'Not signed in.';
        document.getElementById('loginBtn').style.display = 'inline-block';
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('app').style.display = 'none';
      }
    }

    document.getElementById('loginBtn').onclick  = () => Auth.federatedSignIn();
    document.getElementById('logoutBtn').onclick = () =>
      Auth.signOut({ global: true }).then(() => location.href = logoutUri);

    // On load, handle redirect & update UI
    refreshUI();
  </script>
</body>
</html>

